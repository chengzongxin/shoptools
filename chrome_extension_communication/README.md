# Chromeæ’ä»¶ä¸Pythonç¨‹åºWebSocketé€šä¿¡ç¤ºä¾‹

è¿™ä¸ªé¡¹ç›®æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨WebSocketå®ç°Chromeæµè§ˆå™¨æ’ä»¶ä¸æœ¬åœ°Pythonç¨‹åºä¹‹é—´çš„å®æ—¶é€šä¿¡ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
chrome_extension_communication/
â”œâ”€â”€ websocket_server.py          # Python WebSocketæœåŠ¡ç«¯
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–åŒ…
â”œâ”€â”€ chrome_extension_communication/
â”‚   â”œâ”€â”€ background.js           # Chromeæ’ä»¶åå°è„šæœ¬
â”‚   â”œâ”€â”€ popup.html             # æ’ä»¶å¼¹å‡ºé¡µé¢
â”‚   â”œâ”€â”€ popup.js               # å¼¹å‡ºé¡µé¢è„šæœ¬
â”‚   â””â”€â”€ manifest.json          # æ’ä»¶é…ç½®æ–‡ä»¶
â””â”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…Pythonä¾èµ–

```bash
# å®‰è£…WebSocketåº“
pip install -r requirements.txt
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨PythonæœåŠ¡å™¨

```bash
# è¿è¡ŒWebSocketæœåŠ¡å™¨
python3 websocket_server.py
```

æœåŠ¡å™¨å°†åœ¨ `ws://localhost:8765` å¯åŠ¨å¹¶ç›‘å¬è¿æ¥ã€‚

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…Chromeæ’ä»¶

1. æ‰“å¼€Chromeæµè§ˆå™¨
2. è¿›å…¥ `chrome://extensions/`
3. å¼€å¯å³ä¸Šè§’çš„"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹© `chrome_extension_communication` æ–‡ä»¶å¤¹

### ç¬¬å››æ­¥ï¼šæµ‹è¯•é€šä¿¡

1. ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ’ä»¶å›¾æ ‡
2. åœ¨å¼¹å‡ºçš„çª—å£ä¸­ç‚¹å‡»"è¿æ¥æœåŠ¡å™¨"
3. è¿æ¥æˆåŠŸåï¼Œå¯ä»¥è¿›è¡Œå„ç§æµ‹è¯•ï¼š
   - å‘é€é—®å€™æ¶ˆæ¯
   - ä½¿ç”¨è®¡ç®—å™¨åŠŸèƒ½
   - å‘é€è‡ªå®šä¹‰JSONæ¶ˆæ¯

## ğŸ’¡ åŠŸèƒ½ç‰¹æ€§

### WebSocketæœåŠ¡ç«¯åŠŸèƒ½
- âœ… **å¤šå®¢æˆ·ç«¯æ”¯æŒ**ï¼šåŒæ—¶å¤„ç†å¤šä¸ªChromeæ’ä»¶è¿æ¥
- âœ… **æ¶ˆæ¯ç±»å‹å¤„ç†**ï¼šæ”¯æŒé—®å€™ã€è®¡ç®—ã€è‡ªå®šä¹‰æ¶ˆæ¯ç­‰
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯å›åº”
- âœ… **å®æ—¶é€šä¿¡**ï¼šæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯
- âœ… **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„è¿æ¥å’Œæ¶ˆæ¯æ—¥å¿—

### Chromeæ’ä»¶åŠŸèƒ½
- âœ… **å‹å¥½ç•Œé¢**ï¼šç°ä»£åŒ–çš„å¼¹å‡ºå¼ç”¨æˆ·ç•Œé¢
- âœ… **è¿æ¥ç®¡ç†**ï¼šå¯è§†åŒ–è¿æ¥çŠ¶æ€å’Œæ§åˆ¶
- âœ… **æ¶ˆæ¯æµ‹è¯•**ï¼šå¤šç§é¢„è®¾æ¶ˆæ¯ç±»å‹æµ‹è¯•
- âœ… **è‡ªå®šä¹‰æ¶ˆæ¯**ï¼šæ”¯æŒå‘é€JSONæ ¼å¼çš„è‡ªå®šä¹‰æ¶ˆæ¯
- âœ… **æ¶ˆæ¯è®°å½•**ï¼šå®æ—¶æ˜¾ç¤ºå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯

## ğŸ”§ æŠ€æœ¯è¯¦è§£

### ä¸Native Messagingçš„å¯¹æ¯”

| ç‰¹æ€§ | WebSocket | Native Messaging |
|------|-----------|------------------|
| **é…ç½®å¤æ‚åº¦** | ç®€å• | å¤æ‚ï¼ˆéœ€è¦æ³¨å†Œè¡¨é…ç½®ï¼‰ |
| **è·¨å¹³å°æ”¯æŒ** | ä¼˜ç§€ | æœ‰é™åˆ¶ |
| **å®æ—¶æ€§** | ä¼˜ç§€ï¼ˆåŒå‘å®æ—¶ï¼‰ | ä¸€èˆ¬ï¼ˆå•å‘è§¦å‘ï¼‰ |
| **è°ƒè¯•ä¾¿åˆ©æ€§** | ä¼˜ç§€ | å›°éš¾ |
| **æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€** | æ”¯æŒ | ä¸æ”¯æŒ |
| **å¤šå®¢æˆ·ç«¯è¿æ¥** | æ”¯æŒ | ä¸æ”¯æŒ |

### WebSocketé€šä¿¡æµç¨‹

```mermaid
sequenceDiagram
    participant C as Chromeæ’ä»¶
    participant P as PythonæœåŠ¡å™¨
    
    C->>P: å»ºç«‹WebSocketè¿æ¥
    P->>C: è¿æ¥ç¡®è®¤
    C->>P: å‘é€é—®å€™æ¶ˆæ¯
    P->>C: å›åº”é—®å€™
    C->>P: å‘é€è®¡ç®—è¯·æ±‚
    P->>C: è¿”å›è®¡ç®—ç»“æœ
    P->>C: ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰
    C->>P: æ–­å¼€è¿æ¥
```

## ğŸ“ æ¶ˆæ¯æ ¼å¼è§„èŒƒ

### é—®å€™æ¶ˆæ¯
```json
{
    "type": "greeting",
    "content": "ä½ å¥½ï¼ŒPythonæœåŠ¡å™¨ï¼"
}
```

### è®¡ç®—è¯·æ±‚
```json
{
    "type": "calculation",
    "num1": 10,
    "num2": 5,
    "operation": "+"
}
```

### æœåŠ¡å™¨å›åº”
```json
{
    "type": "calculation_result",
    "result": 15
}
```

### é”™è¯¯æ¶ˆæ¯
```json
{
    "type": "error",
    "message": "é”™è¯¯æè¿°"
}
```

## ğŸ› ï¸ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹

1. **åœ¨PythonæœåŠ¡ç«¯æ·»åŠ å¤„ç†é€»è¾‘**ï¼š
```python
elif data.get('type') == 'your_new_type':
    # å¤„ç†æ–°æ¶ˆæ¯ç±»å‹
    response = {
        'type': 'your_response_type',
        'data': 'your_response_data'
    }
```

2. **åœ¨Chromeæ’ä»¶ä¸­æ·»åŠ å‘é€é€»è¾‘**ï¼š
```javascript
function sendNewMessage() {
    const message = {
        type: 'your_new_type',
        // æ·»åŠ å…¶ä»–æ•°æ®
    };
    sendMessage(message);
}
```

### æ·»åŠ ç”¨æˆ·ç•Œé¢å…ƒç´ 

åœ¨ `popup.html` ä¸­æ·»åŠ æ–°çš„HTMLå…ƒç´ ï¼Œå¹¶åœ¨ `popup.js` ä¸­æ·»åŠ å¯¹åº”çš„äº‹ä»¶å¤„ç†é€»è¾‘ã€‚

## ğŸ› å¸¸è§é—®é¢˜

### Q: WebSocketè¿æ¥å¤±è´¥
**A**: ç¡®ä¿PythonæœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”ç«¯å£8765æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨ã€‚

### Q: Chromeæ’ä»¶åŠ è½½å¤±è´¥
**A**: æ£€æŸ¥manifest.jsonæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®ã€‚

### Q: æ¶ˆæ¯å‘é€å¤±è´¥
**A**: ç¡®ä¿WebSocketè¿æ¥å·²å»ºç«‹ï¼Œæ£€æŸ¥æ¶ˆæ¯æ ¼å¼æ˜¯å¦ä¸ºæœ‰æ•ˆJSONã€‚

### Q: å¦‚ä½•ä¿®æ”¹ç«¯å£å·
**A**: åŒæ—¶ä¿®æ”¹ `websocket_server.py` ä¸­çš„ç«¯å£é…ç½®å’Œ `background.js` ä¸­çš„ `WEBSOCKET_URL`ã€‚

## ğŸ“š è¿›é˜¶å­¦ä¹ 

1. **WebSocketåè®®**ï¼šäº†è§£WebSocketçš„åº•å±‚å®ç°åŸç†
2. **Chromeæ’ä»¶å¼€å‘**ï¼šå­¦ä¹ æ›´å¤šChrome Extension API
3. **å¼‚æ­¥ç¼–ç¨‹**ï¼šæ·±å…¥ç†è§£Python asyncioå’ŒJavaScript Promise
4. **ç½‘ç»œå®‰å…¨**ï¼šäº†è§£WebSocketå®‰å…¨æœ€ä½³å®è·µ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ï¿½ï¿½ è®¸å¯è¯

MIT License 