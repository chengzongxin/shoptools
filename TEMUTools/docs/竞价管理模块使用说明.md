# 竞价管理模块使用说明

## 📋 功能概述

竞价管理模块是TEMUTools工具集的新增功能，用于自动化处理TEMU平台的商品竞价流程。该模块可以自动获取待确认邀约和竞价失败的商品，并根据设定的策略进行智能竞价。

## 🎯 主要功能

### 1. **自动获取待处理商品**
- 获取待确认邀约列表（status=2, confirmInvitingStatus=0）
- 获取竞价失败列表（status=5）
- 支持分页获取全部数据

### 2. **智能竞价策略**
- 自动分析当前价格与最低价格
- 如果当前价格已是最低价，则无需竞价
- 否则以"最低价 - 减价金额"作为竞价价格（默认减价0.2元）
- **价格底线保护**: 根据商品类别检查价格阈值，低于底线不参与竞价

### 3. **自动化处理流程**
- 确认邀约（confirmInvitation接口）
- 调整商品价格（gmpProductBatchAdjustPrice接口）
- 实时进度显示和日志记录

### 4. **结果统计与导出**
- 实时统计处理结果
- 支持CSV格式导出竞价结果
- 详细的操作日志记录

## 🖥️ 界面使用

### 竞价配置区域
- **减价金额**: 设置竞价价格相对于最低价的减少金额（单位：元）
  - 竞价价格 = 最低价 - 减价金额
  - 默认值为0.2元，可根据需要调整
- **启用价格底线检查**: 是否根据商品类别检查价格阈值
  - 启用后系统会根据商品类别自动判断价格底线
  - 如果竞价价格或最低价低于类别阈值，将不参与竞价
  - 有效防止恶意低价竞争，保护利润空间

### 控制按钮
- **开始自动竞价**: 启动自动竞价处理流程
- **停止处理**: 中断正在进行的竞价处理
- **清空日志**: 清空界面上的操作日志
- **导出结果**: 将竞价结果导出为CSV文件

### 进度显示
- 实时显示当前处理进度
- 包含进度条和文字描述

### 操作日志
- 实时显示处理过程中的详细日志
- 包含时间戳、日志级别和具体信息

### 处理统计
- **总处理**: 总共处理的商品数量
- **成功**: 成功处理的商品数量
- **实际竞价**: 实际进行了竞价的商品数量
- **无需竞价**: 当前价格已是最低价，无需竞价的商品数量
- **失败**: 处理失败的商品数量

## 📊 处理流程

```
1. 获取待处理商品列表
   ├── 待确认邀约列表
   └── 竞价失败列表

2. 逐个处理商品
   ├── 获取竞价详情
   ├── 分析价格信息
   ├── 计算竞价策略
   └── 执行竞价操作
       ├── 确认邀约
       └── 调整价格

3. 统计并展示结果
   ├── 成功/失败统计
   ├── 竞价详情记录
   └── 支持结果导出
```

## ⚙️ 技术实现

### API接口
1. **搜索供应商接口**: `/PriceComparingOrderSupplierRpcService/searchForSupplier`
2. **竞价详情接口**: `/PriceComparingOrderSupplierRpcService/queryPriceComparingOrderDetail`
3. **确认邀约接口**: `/PriceComparingOrderSupplierRpcService/confirmInvitation`
4. **价格调整接口**: `/gmpProductBatchAdjustPrice`

### 数据模型
- 使用Python dataclass定义完整的数据结构
- 支持复杂的嵌套商品信息和SKU数据
- 类型安全的数据处理

### 错误处理
- 完善的异常捕获和错误提示
- 网络请求失败自动重试
- 用户友好的错误信息显示

## 🔧 配置说明

### 系统配置要求
- 需要在"系统配置"标签页中正确配置Cookie和MallID
- 确保网络连接正常，能够访问TEMU API

### 竞价配置
- **减价金额**: 建议设置为0.1-0.5元之间
- **价格底线检查**: 建议启用，保护利润空间
- **处理策略**: 系统会自动判断是否需要竞价
- **随机延时**: 内置1-3秒随机延时，避免请求过频

### 配置文件管理
- **竞价配置**: `src/config/bid_management_config.json`
- **商品类别配置**: `src/config/category_config.json`
- 支持手动编辑配置文件进行高级设置

## 📈 使用建议

### 1. **首次使用**
- 建议先设置较小的减价金额（如0.1元）进行测试
- 观察处理结果，根据实际情况调整策略

### 2. **批量处理**
- 系统支持自动分页获取全部数据
- 处理过程中会显示实时进度，请耐心等待
- 可随时点击"停止处理"中断操作

### 3. **结果分析**
- 导出的CSV文件包含详细的竞价信息
- 可根据结果分析优化竞价策略
- 关注"无需竞价"的商品，可能已经是最优价格

## ⚠️ 注意事项

1. **Cookie有效性**: 确保Cookie未过期，否则API调用会失败
2. **网络稳定性**: 处理过程中保持网络连接稳定
3. **数据备份**: 建议定期导出处理结果进行备份
4. **合理使用**: 避免过于频繁的竞价操作，遵守平台规则

## 🐛 常见问题

### Q: 竞价处理失败，提示403错误
**A**: 检查系统配置中的Cookie是否有效，可能需要重新获取Cookie

### Q: 没有找到待处理的商品
**A**: 确认当前是否有待确认邀约或竞价失败的商品

### Q: 价格调整失败
**A**: 检查商品状态，确认商品支持价格调整操作

### Q: 处理速度较慢
**A**: 系统内置随机延时机制，避免请求过频，这是正常现象

## 📞 技术支持

如遇到其他问题，请查看操作日志中的详细错误信息，或联系技术支持团队。

---

**版本**: v1.0.0  
**更新时间**: 2025-01-28  
**兼容性**: TEMUTools v1.2.1+
