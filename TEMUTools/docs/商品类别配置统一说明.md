# 商品类别配置统一说明

## 📋 **配置统一优化**

为了提高系统的一致性和可维护性，我们将所有模块的商品类别配置统一到了全局配置文件中。

### 🎯 **优化内容**

#### **1. 全局配置文件**
- **配置文件位置**: `src/config/category_config.json`
- **统一管理**: 所有模块共享同一套商品类别配置
- **配置结构**:
```json
{
  "categories": [
    {
      "name": "帆布袋",
      "cate_id": 29157,
      "image_file": "帆布袋、束口袋.jpg",
      "price_threshold": 10.7,
      "code_mapping": "CB-0608"
    }
    // ... 更多品类
  ]
}
```

#### **2. 配置管理器**
- **CategoryConfigManager**: 统一的配置管理类
- **提供方法**:
  - `get_categories()`: 获取所有品类配置
  - `get_price_threshold_by_category_id()`: 根据类别ID获取价格阈值
  - `get_code_mapping_by_category_id()`: 根据类别ID获取商品码映射
  - `get_code_mapping_by_category_ids()`: 根据类别ID列表获取商品码映射

### 🔄 **模块更新**

#### **1. 实拍图上传模块**
- **原来**: 模块内硬编码品类配置
- **现在**: 从全局配置动态加载
- **优势**: 新增品类时无需修改代码

#### **2. 商品码导出功能**
- **原来**: 通过SKU编码前缀匹配商品码
- **现在**: 通过商品类别ID直接获取code_mapping
- **逻辑流程**:
```
1. 提取商品的类别ID（leafCat + categories）
2. 通过类别ID查询全局配置获取code_mapping
3. 如果未找到，使用原SKU编码匹配作为备选
4. 最终仍未找到则标记为"未定义"
```

#### **3. 竞价管理模块**
- **价格底线检查**: 通过类别ID获取price_threshold
- **智能判断**: 根据商品类别自动应用价格保护策略

#### **4. 核价管理模块**
- **原来**: 仅通过SKU编码前缀匹配价格阈值
- **现在**: 优先通过商品类别ID获取价格阈值，SKU编码作为备选
- **逻辑流程**:
```
1. 提取商品的catIdList（类别ID列表）
2. 通过类别ID查询全局配置获取price_threshold
3. 如果未找到，使用原SKU编码匹配作为备选
4. 最终仍未找到则返回错误信息
```

### 📊 **配置字段说明**

| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `name` | string | 品类名称 | "帆布袋" |
| `cate_id` | number | 品类ID | 29157 |
| `image_file` | string | 实拍图文件名 | "帆布袋、束口袋.jpg" |
| `price_threshold` | number | 价格阈值（元） | 10.7 |
| `code_mapping` | string | 商品码映射 | "CB-0608" |

### 🎨 **商品码映射规则**

| 商品码 | 含义 | 适用品类 |
|--------|------|----------|
| CB-0608 | Canvas Bag | 帆布袋、双肩包、抽绳健身包 |
| BE-0608 | Beanie/Belt | 冰袖、头巾、套头帽、防风面罩 |
| SH-0608 | Scarf/Hat | 头带、工作帽、方巾 |
| SO-0608 | Socks | 袜子相关 |
| AP-0608 | Apron | 围裙 |
| CU-0608 | Cushion | 抱枕 |

### 🔧 **使用方法**

#### **在代码中使用**
```python
from modules.bid_management.config import category_config

# 获取所有品类
categories = category_config.get_categories()

# 根据类别ID获取商品码
code = category_config.get_code_mapping_by_category_id(29157)

# 根据类别ID列表获取商品码（返回第一个匹配的）
code = category_config.get_code_mapping_by_category_ids([29157, 27011])

# 根据类别ID获取价格阈值
threshold = category_config.get_price_threshold_by_category_id(29157)
```

#### **添加新品类**
1. 编辑 `src/config/category_config.json`
2. 添加新的品类配置项
3. 重启程序（配置会自动加载）

### ✅ **优化效果**

#### **1. 一致性提升**
- 所有模块使用相同的品类配置
- 避免配置不同步的问题
- 统一的数据结构和访问方式

#### **2. 维护性改善**
- 新增品类只需修改配置文件
- 无需修改多个模块的代码
- 配置变更影响范围可控

#### **3. 功能增强**
- 商品码导出更准确（基于类别ID而非SKU前缀）
- 价格底线保护更精确
- 支持多级类别匹配

#### **4. 扩展性提升**
- 配置结构支持添加新字段
- 支持更复杂的品类关系
- 便于集成新的业务逻辑

### 🚀 **后续计划**

1. **配置界面**: 开发图形化配置管理界面
2. **配置验证**: 添加配置文件格式验证
3. **热更新**: 支持配置文件热更新，无需重启
4. **配置同步**: 支持多环境配置同步

---

**版本**: v2.1.0  
**更新时间**: 2025-01-28  
**影响模块**: 实拍图上传、商品码导出、竞价管理、核价管理
